# =============================================================================
# Sync Schema
# =============================================================================
# Defines how captures synchronize with peers across views.
# Sync is peer-based: bidirectional by default.
#
# Namespaces:
#   exfs.*              - File traversal (captures in .exfs/ files)
#   core.*              - System-provided (terminals, transpiler)
# =============================================================================

$schema: "https://json-schema.org/draft/2020-12/schema"
$id: "https://exfs.org/schemas/core/sync"
title: "Sync Schema"
description: "Peer-to-peer synchronization between captures"

$defs:
  # ---------------------------------------------------------------------------
  # Sync Array
  # ---------------------------------------------------------------------------
  sync:
    type: array
    items:
      $ref: "#/$defs/sync_entry"
    minItems: 1

  # ---------------------------------------------------------------------------
  # Sync Entry
  # ---------------------------------------------------------------------------
  # Defines relationship with a single peer.
  #
  # Required:
  #   path      - The peer capture (exfs.<view>.<path>.<file>.<capture>)
  #
  # Optional:
  #   direction - source or target (default: bidirectional)
  #   engine    - Transform yaml path (default: core.transpiler)
  # ---------------------------------------------------------------------------
  sync_entry:
    type: object
    required:
      - path
    properties:
      path:
        type: string
        pattern: "^exfs\\."
        description: "Peer capture path (exfs.<view>.<path>.<file>.<capture>)"

      direction:
        type: string
        enum: [source, target]
        description: |
          Omit for bidirectional (default).
          source - This capture pushes to peer
          target - This capture receives from peer

      engine:
        type: string
        description: |
          Path to transform yaml file (anywhere except .exfs/).
          Defaults to core.transpiler if omitted.

    additionalProperties: false
